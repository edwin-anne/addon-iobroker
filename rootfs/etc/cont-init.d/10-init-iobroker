#!/usr/bin/with-contenv bashio

bashio::log.info "Initialisation de ioBroker..."

# Vérifier si ioBroker est déjà installé
if [ ! -d "/opt/iobroker" ]; then
    bashio::log.info "Installation de ioBroker..."
    
    # Installer ioBroker avec le script d'installation fourni
    bash /tmp/install.sh --silent
    
    # Attendre que l'installation soit terminée
    sleep 5
    
    bashio::log.info "ioBroker installé avec succès!"
else
    bashio::log.info "ioBroker est déjà installé, passage à l'étape suivante..."
fi

# Configurer les permissions
if [ -d "/opt/iobroker" ]; then
    bashio::log.info "Configuration des permissions..."
    chown -R iobroker:iobroker /opt/iobroker
fi

bashio::log.info "Initialisation terminée!" 